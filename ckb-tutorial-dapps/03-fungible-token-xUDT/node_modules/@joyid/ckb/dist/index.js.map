{"version":3,"sources":["../src/index.ts","../src/aggregator.ts","../src/utils.ts","../src/verify.ts","../src/constants.ts"],"names":["bufferToHex","append0x","remove0x","fetch","SigningAlg","openPopup","hexToBytes","getConfig"],"mappings":"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","sourcesContent":["import {\n  type CKBTransaction,\n  createBlockDialog,\n  buildJoyIDURL,\n  openPopup,\n  runPopup,\n  type PopupConfigOptions,\n  authWithPopup,\n  signMessageWithPopup,\n  internalConfig as internalDappConfig,\n  type CkbDappConfig,\n  DappRequestType,\n  type CkbTransactionRequest,\n  type CotaNFTTransactionRequest,\n  type SignCotaNFTRequest,\n  type SignCkbTxResponseData,\n  type AuthResponseData,\n  type SignMessageResponseData,\n  type SignCkbTxRequest,\n  bufferToHex,\n  append0x,\n  remove0x,\n} from '@joyid/common'\nimport * as ckbUtils from '@nervosnetwork/ckb-sdk-utils'\nimport { Aggregator } from './aggregator'\nimport { deserializeWitnessArgs } from './utils'\n\nexport * from './verify'\n\nconst {\n  PERSONAL,\n  addressToScript,\n  blake160,\n  blake2b,\n  hexToBytes,\n  toUint64Le,\n  serializeScript,\n  rawTransactionToHash,\n  serializeWitnessArgs,\n} = ckbUtils\n\nconst appendPrefix = (tokenKey?: string): string | undefined => {\n  if (!tokenKey) {\n    return tokenKey\n  }\n  const key = remove0x(tokenKey)\n  // the length of CoTA NFT token key is 24 bytes and mNFT is 28 bytes\n  if (key.length === 48) {\n    return `ffffffff${key}`\n  }\n  return key\n}\n\nconst generateSignURL = (\n  config: SignCkbTxRequest | SignCotaNFTRequest,\n  isCkb = true\n): string => {\n  const { joyidAppURL: __, joyidServerURL: _, ...ckbDappConfig } = config\n  const path = isCkb ? '/sign-ckb' : '/sign-cota-nft'\n  const dappConfig = ckbDappConfig\n  if (!isCkb) {\n    const tx = dappConfig.tx as CotaNFTTransactionRequest\n    tx.tokenKey = appendPrefix(tx.tokenKey)\n    dappConfig.tx = tx\n  }\n  return buildJoyIDURL(dappConfig, 'popup', path)\n}\n\nexport const initConfig = (config?: CkbDappConfig): CkbDappConfig => {\n  Object.assign(internalDappConfig, config)\n  return internalDappConfig as CkbDappConfig\n}\n\nexport const getConfig = (): CkbDappConfig => internalDappConfig\n\n// The witnessIndexes represents the positions of the JoyID cells in inputs, the default value is an empty array\n// e.g. If the transaction inputs have two JoyID cells whose positions are 1 and 3(zero-based index), the witnessIndexes should be [1, 3]\nexport type SignConfig = CkbDappConfig &\n  Pick<PopupConfigOptions, 'timeoutInSeconds' | 'popup'> & {\n    witnessIndexes?: number[]\n  }\n\nexport const connect = async (\n  config?: SignConfig\n): Promise<AuthResponseData> => {\n  config = {\n    ...internalDappConfig,\n    ...config,\n  }\n  const res = await authWithPopup({\n    redirectURL: location.href,\n    ...config,\n  })\n  return res\n}\n\nexport const signChallenge = async (\n  challenge: string | Uint8Array,\n  signerAddress: string,\n  config?: SignConfig\n): Promise<SignMessageResponseData> => {\n  const isData = typeof challenge !== 'string'\n\n  config = {\n    ...internalDappConfig,\n    ...config,\n  }\n  const res = await signMessageWithPopup({\n    challenge:\n      typeof challenge === 'string' ? challenge : bufferToHex(challenge),\n    isData,\n    address: signerAddress,\n    redirectURL: location.href,\n    ...config,\n  })\n\n  return res\n}\n\nexport const signTransaction = async (\n  tx: CkbTransactionRequest,\n  config?: SignConfig\n): Promise<CKBTransaction> => {\n  config = {\n    ...internalDappConfig,\n    ...config,\n  }\n\n  if (!config.popup) {\n    config.popup = openPopup('')\n\n    if (!config.popup) {\n      return createBlockDialog(async () => signTransaction(tx, config))\n    }\n  }\n\n  const { popup, timeoutInSeconds, ...dappConfig } = config\n\n  config.popup.location.href = generateSignURL({\n    ...dappConfig,\n    tx,\n    signerAddress: tx.from,\n    redirectURL: location.href,\n  })\n\n  const res = await runPopup({\n    timeoutInSeconds: timeoutInSeconds ?? 5000,\n    popup,\n    type: DappRequestType.SignCkbTx,\n  })\n\n  return res.tx\n}\n\nexport const signCotaNFTTx = async (\n  tx: CotaNFTTransactionRequest,\n  config?: SignConfig\n): Promise<CKBTransaction> => {\n  config = {\n    ...internalDappConfig,\n    ...config,\n  }\n\n  if (!config.popup) {\n    config.popup = openPopup('')\n\n    if (!config.popup) {\n      return createBlockDialog(async () => signCotaNFTTx(tx, config))\n    }\n  }\n\n  const { popup, timeoutInSeconds, ...dappConfig } = config\n\n  config.popup.location.href = generateSignURL(\n    {\n      ...dappConfig,\n      tx,\n      signerAddress: tx.from,\n      redirectURL: location.href,\n    },\n    false\n  )\n\n  const res = await runPopup({\n    timeoutInSeconds: timeoutInSeconds ?? 5000,\n    popup,\n    type: DappRequestType.SignCotaNFT,\n  })\n\n  return res.tx\n}\n\nexport const signRawTransaction = async (\n  tx: CKBTransaction,\n  signerAddress: string,\n  config?: SignConfig\n): Promise<SignCkbTxResponseData['tx']> => {\n  config = {\n    ...tx,\n    ...internalDappConfig,\n    ...config,\n  }\n\n  const { witnessIndexes } = config\n\n  if (Array.isArray(witnessIndexes)) {\n    if (witnessIndexes.length === 0) {\n      throw new Error('The witnessIndexes must be not empty')\n    }\n    if (witnessIndexes.length > tx.inputs.length) {\n      throw new Error(\n        'The length of witnessIndexes must not be bigger than the length of inputs'\n      )\n    }\n  }\n\n  if (!config.popup) {\n    config.popup = openPopup('')\n\n    if (!config.popup) {\n      return createBlockDialog(async () =>\n        signRawTransaction(tx, signerAddress, config)\n      )\n    }\n  }\n\n  const { popup, timeoutInSeconds, ...ckbDappConfig } = config\n\n  config.popup.location.href = buildJoyIDURL(\n    {\n      ...ckbDappConfig,\n      tx,\n      signerAddress,\n      redirectURL: location.href,\n    },\n    'popup',\n    '/sign-ckb-raw-tx'\n  )\n\n  const res = await runPopup({\n    timeoutInSeconds: timeoutInSeconds ?? 5000,\n    popup,\n    type: DappRequestType.SignCkbRawTx,\n  })\n\n  return res.tx\n}\n\nconst SECP256R1_PUBKEY_SIG_LEN = 129\n// The witnessIndexes represents the positions of the JoyID cells in inputs, the default value is an array containing only 0\n// e.g. If the transaction inputs have two JoyID cells whose positions are 1 and 3(zero-based index), the witnessIndexes should be [1, 3]\nexport const calculateChallenge = async (\n  tx: CKBTransaction,\n  witnessIndexes = [0]\n): Promise<string> => {\n  const { witnesses } = tx\n  if (witnesses.length === 0) {\n    throw new Error('Witnesses cannot be empty')\n  }\n\n  if (witnessIndexes.length === 0) {\n    throw new Error('JoyID witnesses can not be empty')\n  }\n\n  const firstWitnessIndex = witnessIndexes[0] ?? 0\n  if (typeof tx.witnesses[firstWitnessIndex] !== 'string') {\n    throw new TypeError(\n      'The first JoyID witness must be serialized hex string of WitnessArgs'\n    )\n  }\n  const transactionHash = rawTransactionToHash(tx)\n  const witnessArgs = deserializeWitnessArgs(tx.witnesses[firstWitnessIndex]!)\n\n  const emptyWitness: CKBComponents.WitnessArgs = {\n    ...witnessArgs,\n    lock: `0x${'00'.repeat(SECP256R1_PUBKEY_SIG_LEN)}`,\n  }\n\n  console.log(console.log(emptyWitness))\n\n  const serializedEmptyWitnessBytes = hexToBytes(\n    serializeWitnessArgs(emptyWitness)\n  )\n  const serializedEmptyWitnessSize = serializedEmptyWitnessBytes.length\n\n  const hasher = blake2b(32, null, null, PERSONAL)\n  hasher.update(hexToBytes(transactionHash))\n  hasher.update(\n    hexToBytes(toUint64Le(`0x${serializedEmptyWitnessSize.toString(16)}`))\n  )\n  hasher.update(serializedEmptyWitnessBytes)\n\n  for (const witnessIndex of witnessIndexes.slice(1)) {\n    const witness = witnesses[witnessIndex]\n    if (witness) {\n      const bytes = hexToBytes(\n        typeof witness === 'string' ? witness : serializeWitnessArgs(witness)\n      )\n      hasher.update(hexToBytes(toUint64Le(`0x${bytes.length.toString(16)}`)))\n      hasher.update(bytes)\n    }\n  }\n\n  if (witnesses.length > tx.inputs.length) {\n    for (const witness of witnesses.slice(tx.inputs.length)) {\n      const bytes = hexToBytes(\n        typeof witness === 'string' ? witness : serializeWitnessArgs(witness)\n      )\n      hasher.update(hexToBytes(toUint64Le(`0x${bytes.length.toString(16)}`)))\n      hasher.update(bytes)\n    }\n  }\n\n  const challenge = `${hasher.digest('hex')}`\n  return challenge\n}\n\nconst WITNESS_NATIVE_MODE = '01'\nconst WITNESS_SUBKEY_MODE = '02'\n// The witnessIndexes represents the positions of the JoyID cells in inputs, the default value is an array containing only 0\n// e.g. If the transaction inputs have two JoyID cells whose positions are 1 and 3(zero-based index), the witnessIndexes should be [1, 3]\nexport const buildSignedTx = (\n  unsignedTx: CKBTransaction,\n  signedData: SignMessageResponseData,\n  witnessIndexes = [0]\n): CKBTransaction => {\n  if (unsignedTx.witnesses.length === 0) {\n    throw new Error('Witnesses length error')\n  }\n  const firstWitnessIndex = witnessIndexes[0] ?? 0\n  const firstWitness = unsignedTx.witnesses[firstWitnessIndex]!\n  const witnessArgs = deserializeWitnessArgs(firstWitness)\n\n  const { message, signature, pubkey, keyType } = signedData\n\n  const mode = keyType === 'sub_key' ? WITNESS_SUBKEY_MODE : WITNESS_NATIVE_MODE\n  witnessArgs.lock = `0x${mode}${pubkey}${signature}${message}`\n\n  const signedWitness = append0x(serializeWitnessArgs(witnessArgs))\n\n  const signedTx = unsignedTx\n  signedTx.witnesses[firstWitnessIndex] = signedWitness\n\n  return signedTx\n}\n\nexport const getSubkeyUnlock = async (\n  aggregatorUrl: string,\n  connection: AuthResponseData\n): Promise<string> => {\n  const pubkeyHash = append0x(blake160(append0x(connection.pubkey), 'hex'))\n  const lock = addressToScript(connection.address)\n  const req = {\n    lock_script: serializeScript(lock),\n    pubkey_hash: pubkeyHash,\n    alg_index: 1, // secp256r1\n  }\n  const aggregator = new Aggregator(aggregatorUrl)\n  const { unlock_entry: unlockEntry } =\n    await aggregator.generateSubkeyUnlockSmt(req)\n  return unlockEntry\n}\n\nexport {\n  type AuthRequest,\n  type AuthResponse,\n  type SignMessageResponse,\n  type SignMessageRequest,\n  type CredentialKeyType,\n  SigningAlg,\n  type CkbDappConfig,\n  openPopup,\n  type PopupConfigOptions as PopupConifg,\n  type AuthResponseData as ConnectResponseData,\n  type SignMessageResponseData as SignChallengeResponseData,\n  type CotaNFTTransactionRequest,\n  type SignCotaNFTRequest,\n  type SignCkbTxRequest,\n  type CKBTransaction,\n} from '@joyid/common'\nexport {\n  getJoyIDCellDep,\n  getCotaTypeScript,\n  getJoyIDLockScript,\n  getCotaCellDep,\n} from './constants'\n\nexport { Aggregator } from './aggregator'\n","import fetch from 'cross-fetch'\nimport {\n  type BaseReq,\n  type BaseResp,\n  type SubkeyUnlockReq,\n  type SubkeyUnlockResp,\n} from './types'\n\nconst payloadId = (): number => Date.now()\n\nexport class Aggregator {\n  private readonly url: string\n\n  constructor(url: string) {\n    this.url = url\n  }\n\n  private async baseRPC(\n    method: string,\n    req: BaseReq | undefined,\n    url = this.url\n  ): Promise<BaseResp | undefined> {\n    const payload = {\n      id: payloadId(),\n      jsonrpc: '2.0',\n      method,\n      params: req ?? null,\n    }\n    const body = JSON.stringify(payload, null, '')\n\n    const data = await fetch(url, {\n      method: 'post',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body,\n    }).then(async (res) => res.json())\n\n    if (data.error != null) {\n      throw new Error(`RPC error: ${JSON.stringify(data.error)}`)\n    }\n\n    return data.result\n  }\n\n  async generateSubkeyUnlockSmt(\n    req: SubkeyUnlockReq\n  ): Promise<SubkeyUnlockResp> {\n    return (await this.baseRPC(\n      'generate_subkey_unlock_smt',\n      req\n    )) as Promise<SubkeyUnlockResp>\n  }\n}\n","/* eslint-disable unicorn/prefer-string-slice */\n\nimport { append0x, remove0x } from '@joyid/common'\nimport { hexToBytes } from '@nervosnetwork/ckb-sdk-utils'\n\n/**\n * Web crypto use IEEE P1363 ECDSA signature format\n * ref: https://stackoverflow.com/questions/39554165/ecdsa-signatures-between-node-js-and-webcrypto-appear-to-be-incompatible\n * code from: https://github.com/java-crypto/cross_platform_crypto/blob/main/docs/ecdsa_signature_conversion.md\n */\nexport function derToIEEE(sig: ArrayBuffer): Uint8Array {\n  const signature = Array.from(new Uint8Array(sig), (x) =>\n    `00${x.toString(16)}`.slice(-2)\n  ).join('')\n  const rLength = Number.parseInt(signature.substr(6, 2), 16) * 2\n  let r = signature.substr(8, rLength)\n  let s = signature.substr(12 + rLength)\n  r = r.length > 64 ? r.substr(-64) : r.padStart(64, '0')\n  s = s.length > 64 ? s.substr(-64) : s.padStart(64, '0')\n  const p1363Sig = `${r}${s}`\n  return new Uint8Array(\n    p1363Sig.match(/[\\da-f]{2}/gi)!.map((h) => Number.parseInt(h, 16))\n  )\n}\n\nexport function leHexStringToU32(hex: string): number {\n  const bytes = hexToBytes(append0x(hex))\n  const beHex = `0x${bytes.reduceRight((pre, cur) => pre + cur.toString(16).padStart(2, '0'), '')}`\n  return Number.parseInt(beHex)\n}\n\nexport function deserializeWitnessArgs(hex: string): CKBComponents.WitnessArgs {\n  const args = remove0x(hex)\n  // full_size(4bytes) + offsets(4bytes * 3) + body(lock + input_type + output_type)\n  const lockOffset = leHexStringToU32(args.slice(8, 16)) * 2\n  const inputTypeOffset = leHexStringToU32(args.slice(16, 24)) * 2\n  const outputTypeOffset = leHexStringToU32(args.slice(24, 32)) * 2\n\n  // lock = size(4bytes) + body\n  const lock = args.slice(lockOffset, inputTypeOffset).slice(8)\n  const inputType = args.slice(inputTypeOffset, outputTypeOffset).slice(8)\n  const outputType = args.slice(outputTypeOffset).slice(8)\n\n  return {\n    lock: lock.length === 0 ? '0x' : `0x${lock}`,\n    inputType: inputType.length === 0 ? '0x' : `0x${inputType}`,\n    outputType: outputType.length === 0 ? '0x' : `0x${outputType}`,\n  }\n}\n","import fetch from 'cross-fetch'\nimport { subtle } from 'uncrypto'\nimport {\n  SigningAlg,\n  type CredentialKeyType,\n  getConfig,\n  type SignMessageResponseData,\n  bufferToHex,\n  appendBuffer,\n  base64URLStringToBuffer,\n  bufferToBase64URLString,\n  hexToArrayBuffer,\n  hexToString,\n  utf8StringToBuffer,\n} from '@joyid/common'\nimport { derToIEEE } from './utils'\n\nexport const ensureChallenge = (\n  challenge: string,\n  clientData: ArrayBuffer\n): boolean => {\n  try {\n    const clienDataJSON = hexToString(bufferToHex(clientData))\n    const clientDataObj = JSON.parse(clienDataJSON)\n    return (\n      clientDataObj.challenge ===\n      bufferToBase64URLString(utf8StringToBuffer(challenge))\n    )\n  } catch (error) {\n    return false\n  }\n}\n\nexport const verifySessionKeySignature = async (\n  message: string,\n  signature: string,\n  pubkey: string\n): Promise<boolean> => {\n  try {\n    const algoName = 'RSASSA-PKCS1-v1_5'\n    const pk = hexToArrayBuffer(pubkey)\n    const msg = base64URLStringToBuffer(message)\n    const sig = base64URLStringToBuffer(signature)\n    const e = new Uint8Array(pk.slice(0, 3)).reverse()\n    const n = new Uint8Array(pk.slice(4)).reverse()\n\n    // import rsa public key as RSASSA-PKCS1-v1_5\tsubtle key\n    const jwkPubkey: JsonWebKey = {\n      alg: 'RS256',\n      ext: true,\n      key_ops: ['verify'],\n      kty: 'RSA',\n      e: bufferToBase64URLString(e),\n      n: bufferToBase64URLString(n),\n    }\n    const key = await subtle.importKey(\n      'jwk',\n      jwkPubkey,\n      {\n        name: algoName,\n        hash: 'SHA-256',\n      },\n      false,\n      ['verify']\n    )\n    const res = await subtle.verify(algoName, key, sig, msg)\n    return res\n  } catch (error) {\n    console.error(error)\n    return false\n  }\n}\n\nexport const verifyNativeKeySignature = async ({\n  message,\n  signature,\n  pubkey,\n  challenge,\n  alg,\n}: SignMessageResponseData): Promise<boolean> => {\n  try {\n    const pk = hexToArrayBuffer(`${pubkey}`)\n    const msg = base64URLStringToBuffer(message)\n    const sig = base64URLStringToBuffer(signature)\n    const authData = msg.slice(0, 37)\n    const clientData = msg.slice(37)\n    if (!ensureChallenge(challenge, clientData)) {\n      return false\n    }\n    const clientDataHash = await subtle.digest('SHA-256', clientData)\n    const signatureBase = appendBuffer(authData, clientDataHash)\n    const isR1 = alg === SigningAlg.ES256\n    const jwkPubkey: JsonWebKey = isR1\n      ? {\n          kty: 'EC',\n          crv: 'P-256',\n          x: bufferToBase64URLString(pk.slice(0, 32)),\n          y: bufferToBase64URLString(pk.slice(32)),\n        }\n      : {\n          alg: 'RS256',\n          ext: true,\n          key_ops: ['verify'],\n          kty: 'RSA',\n          e: bufferToBase64URLString(new Uint8Array(pk.slice(0, 3)).reverse()),\n          n: bufferToBase64URLString(new Uint8Array(pk.slice(4)).reverse()),\n        }\n    const algo = isR1\n      ? {\n          name: 'ECDSA',\n          namedCurve: 'P-256',\n          hash: { name: 'SHA-256' },\n        }\n      : {\n          name: 'RSASSA-PKCS1-v1_5',\n          hash: 'SHA-256',\n        }\n    const key = await subtle.importKey('jwk', jwkPubkey, algo, false, [\n      'verify',\n    ])\n    const res = await subtle.verify(\n      algo,\n      key,\n      alg === SigningAlg.RS256 ? sig : derToIEEE(sig),\n      signatureBase\n    )\n    return res\n  } catch (error) {\n    console.error(error)\n    return false\n  }\n}\n\nexport const verifySignature = async (\n  data: SignMessageResponseData\n): Promise<boolean> => {\n  const { message, signature, pubkey, keyType } = data\n  if (keyType === 'main_key' || keyType === 'sub_key') {\n    return verifyNativeKeySignature(data)\n  }\n  return verifySessionKeySignature(message, signature, pubkey)\n}\n\ninterface CredentialInfo {\n  pubkey: string\n  address: string\n  keyType: CredentialKeyType\n  alg: SigningAlg\n}\n\n/**\n * Verifies the credential information.\n *\n * @param {CredentialInfo} credential Information of the credential to verify.\n * @param {string} joyidServerURL The URL of the JOYID server. <br>\n * Testnet: https://api.testnet.joyid.dev/api/v1 <br>\n * Mainnet: https://api.joy.id/api/v1\n * @returns {Promise<boolean>} A promise that resolves to a boolean indicating\n *                              whether the verification was successful.\n */\nexport async function verifyCredential(\n  credential: CredentialInfo,\n  joyidServerURL: string\n): Promise<boolean>\n\n/**\n * Verifies the credential information.\n *\n * @param {string} pubkey The public key of the credential to verify.\n * @param {string} address The address of the credential to verify.\n * @param {CredentialKeyType} keyType Type of the key.\n * @param {SigningAlg} alg The signing algorithm to be used.\n * @returns {Promise<boolean>} A promise that resolves to a boolean indicating\n *                              whether the verification was successful.\n */\nexport async function verifyCredential(\n  pubkey: string,\n  address: string,\n  keyType: CredentialKeyType,\n  alg: SigningAlg\n): Promise<boolean>\n\n/**\n * Verifies the credential information.\n *\n * @param {string|CredentialInfo} credentialOrPubkey Either the public key or\n *                                                    the `CredentialInfo`.\n * @param {string} addressOrJoyidServerURL Either the address or\n *                                         the `joyidServerURL`.\n * Testnet: https://api.testnet.joyid.dev/api/v1 <br>\n * Mainnet: https://api.joy.id/api/v1\n * @param {CredentialKeyType} _keyType Type of the key.\n * @param {SigningAlg} _alg The signing algorithm to be used.\n * @returns {Promise<boolean>} A promise that resolves to a boolean indicating\n *                              whether the verification was successful.\n */\nexport async function verifyCredential(\n  credentialOrPubkey: string | CredentialInfo,\n  addressOrJoyidServerURL?: string,\n  _keyType?: CredentialKeyType,\n  _alg?: SigningAlg\n): Promise<boolean> {\n  let pubkey: string,\n    address: string,\n    keyType: CredentialKeyType,\n    alg: SigningAlg\n\n  let serverURL = getConfig().joyidServerURL\n\n  if (typeof credentialOrPubkey === 'string') {\n    pubkey = credentialOrPubkey\n    address = addressOrJoyidServerURL!\n    keyType = _keyType!\n    alg = _alg!\n  } else {\n    ;({ pubkey, address, keyType, alg } = credentialOrPubkey)\n    serverURL = addressOrJoyidServerURL\n  }\n\n  try {\n    const result = await fetch(`${serverURL}/credentials/${address}`, {\n      method: 'GET',\n      headers: {\n        'User-Agent':\n          'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36',\n      },\n    }).then(async (res) => res.json())\n\n    return result.credentials.some((c: any) => {\n      const pk =\n        alg === SigningAlg.RS256 ||\n        keyType === 'main_session_key' ||\n        keyType === 'sub_session_key'\n          ? c.public_key\n          : c.public_key.slice(2)\n      return c.ckb_address === address && pk === pubkey\n    })\n  } catch (error) {\n    console.error(error)\n    return false\n  }\n}\n\nexport { type SigningAlg, type CredentialKeyType } from '@joyid/common'\n","import { type CellDep, type Script } from '@joyid/common'\n\nconst TestnetInfo = {\n  JoyIDLockScript: {\n    codeHash:\n      '0xd23761b364210735c19c60561d213fb3beae2fd6172743719eff6920e020baac',\n    hashType: 'type',\n    args: '',\n  } as Script,\n\n  JoyIDLockDep: {\n    outPoint: {\n      txHash:\n        '0x4dcf3f3b09efac8995d6cbee87c5345e812d310094651e0c3d9a730f32dc9263',\n      index: '0x0',\n    },\n    depType: 'depGroup',\n  } as CellDep,\n\n  CotaTypeScript: {\n    codeHash:\n      '0x89cd8003a0eaf8e65e0c31525b7d1d5c1becefd2ea75bb4cff87810ae37764d8',\n    hashType: 'type',\n    args: '0x',\n  } as Script,\n\n  CotaTypeDep: {\n    outPoint: {\n      txHash:\n        '0x636a786001f87cb615acfcf408be0f9a1f077001f0bbc75ca54eadfe7e221713',\n      index: '0x0',\n    },\n    depType: 'depGroup',\n  } as CellDep,\n}\n\nconst MainnetInfo = {\n  JoyIDLockScript: {\n    codeHash:\n      '0xd00c84f0ec8fd441c38bc3f87a371f547190f2fcff88e642bc5bf54b9e318323',\n    hashType: 'type',\n    args: '',\n  } as Script,\n\n  JoyIDLockDep: {\n    outPoint: {\n      txHash:\n        '0xf05188e5f3a6767fc4687faf45ba5f1a6e25d3ada6129dae8722cb282f262493',\n      index: '0x0',\n    },\n    depType: 'depGroup',\n  } as CellDep,\n\n  CotaTypeScript: {\n    codeHash:\n      '0x1122a4fb54697cf2e6e3a96c9d80fd398a936559b90954c6e88eb7ba0cf652df',\n    hashType: 'type',\n    args: '0x',\n  } as Script,\n\n  CotaTypeDep: {\n    outPoint: {\n      txHash:\n        '0xabaa25237554f0d6c586dc010e7e85e6870bcfd9fb8773257ecacfbe1fd738a0',\n      index: '0x0',\n    },\n    depType: 'depGroup',\n  } as CellDep,\n}\n\nexport const getJoyIDLockScript = (isMainnet: boolean): Script =>\n  isMainnet ? MainnetInfo.JoyIDLockScript : TestnetInfo.JoyIDLockScript\nexport const getJoyIDCellDep = (isMainnet: boolean): CellDep =>\n  isMainnet ? MainnetInfo.JoyIDLockDep : TestnetInfo.JoyIDLockDep\n\nexport const getCotaTypeScript = (isMainnet: boolean): Script =>\n  isMainnet ? MainnetInfo.CotaTypeScript : TestnetInfo.CotaTypeScript\nexport const getCotaCellDep = (isMainnet: boolean): CellDep =>\n  isMainnet ? MainnetInfo.CotaTypeDep : TestnetInfo.CotaTypeDep\n"]}